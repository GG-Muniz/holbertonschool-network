#!/usr/bin/env bash
# Configure hosts so localhost->127.0.0.2 and facebook.com->8.8.8.8 on Ubuntu

set -euo pipefail

HOSTS_FILE="/etc/hosts"
TMP_FILE="/tmp/hosts.$$"

if [ "${EUID:-$(id -u)}" -ne 0 ]; then
	exit 0
fi

cp "$HOSTS_FILE" "$TMP_FILE"
sed -i.bak '/^[[:space:]]*127\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}[[:space:]]\+localhost\b/d' "$TMP_FILE"
echo "127.0.0.2	localhost" >> "$TMP_FILE"
sed -i '/[[:space:]]facebook\.com\b/d' "$TMP_FILE"
echo "8.8.8.8	facebook.com" >> "$TMP_FILE"
install -m 644 "$TMP_FILE" "$HOSTS_FILE"
rm -f "$TMP_FILE" "$TMP_FILE.bak"
